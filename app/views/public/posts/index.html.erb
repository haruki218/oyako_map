<div class="custom-container-fluid mt-3">
  <div class="row">
    <!--サイドバー-->
    <div class="col-md-2">
      <%= render 'public/shared/sidebar' %>
    </div>
    <!--メインコンテンツ-->
    <div class="col-md-10">
      <h1>みんなの投稿</h1>
      <!--絞り込み機能-->
      <%= render 'public/shared/filter', path: posts_path %>
      <!--ソート機能-->
      <div class="mb-3">
        <%= link_to '新しい順', posts_path(latest: "true", facility_type: params[:facility_type]) %> |
        <%= link_to '古い順', posts_path(old: "true", facility_type: params[:facility_type]) %> |
        <%= link_to '評価が高い順', posts_path(highly_rated: "true", facility_type: params[:facility_type]) %> |
        <%= link_to 'コメントが多い順', posts_path(most_commented: "true", facility_type: params[:facility_type]) %>
      </div>
    
      <table class="table">
        <thead>
          <tr>
            <th>画像</th>
            <th>タイトル</th>
            <th>評価</th>
            <th>住所</th>
            <th>コメント</th>
            <th>タグ</th>
          </tr>
        </thead>
        <tbody>
          <% @posts.each do |post| %>
            <tr>
              <td>
                <% if post.images.attached? %>
                  <%= link_to post_path(post) do %>
                    <%= image_tag post.images.first.variant(resize_to_limit: [200, 150]), class: "table-image", data: {turbolinks: "false"} %>
                  <% end %>
                <% else %>
                  <%= link_to post_path(post) do %>
                    <%= image_tag asset_path('no-image.png'), class: "table-image", data: {turbolinks: "false"} %>
                  <% end %>
                <% end %>
              </td>
              <td><%= link_to post.title, post_path(post), data: {turbolinks: "false"} %></td>
              <td>
                <% if post.comments.any? %>
                  <%= number_with_precision(post.average_rating, precision: 1) %> / 5
                <% else %>
                  評価なし
                <% end %>
              </td>
              <td><%= post.address %></td>
              <td>
                <% if post.comments.any? %>
                  <%= post.comments.last.content.truncate(30) %>
                <% else %>
                  コメントなし
                <% end %>
              </td>
              <td>
              <% post.tags.each do |tag| %>
                <%= link_to tag.name, tag_path(tag), class: "badge badge-info" %>
              <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <div class="row d-flex justify-content-center mb-3">
        <%= paginate @posts %>
      </div>
    </div>
  </div>
</div>
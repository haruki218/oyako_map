<div class="container mt-3">

  <% if @model == 'user' %>
    <h1>"<%= @content %>"のユーザー検索結果</h1>
    <% if @records.any? %>
      <table class="table">
        <thead>
          <tr>
            <th>ユーザー名</th>
            <th>登録日</th>
            <th>最近の投稿</th>
            <th>最近のコメント</th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |user| %>
            <% unless user.guest_user? %> <!--ゲストユーザーは表示しない-->
              <tr>
                <td><%= link_to user.name, admin_user_path(user) %></td>
                <td><%= user.created_at.strftime("%Y-%m-%d") %></td>
                <td>
                  <% if user.posts.any? %>
                    <%= link_to user.posts.last.title, admin_post_path(user.posts.last), data: {turbolinks: "false"} %>
                    <small>(<%= user.posts.last.created_at.strftime("%Y-%m-%d") %>)</small>
                  <% else %>
                    まだ投稿がありません
                  <% end %>
                </td>
                <td>
                  <% if user.comments.any? %>
                    <%= user.comments.last.content.truncate(30) %>
                    <small>(<%= user.comments.last.created_at.strftime("%Y-%m-%d") %>)</small>
                  <% else %>
                    まだコメントがありません
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>該当するユーザーが見つかりませんでした</p>
    <% end %>

  <% elsif @model == 'post' %>
  <h1>"<%= @content %>"の投稿検索結果</h1>
  <!--絞り込み機能-->
  <%= render 'public/shared/filter', path: admin_search_path %>
  <!--ソート機能-->
  <%= render 'public/shared/search_sort', path: admin_search_path %>

    <% if @records.any? %>
      <table class="table">
        <thead>
          <tr>
            <th>ユーザー</th>
            <th>タイトル</th>
            <th>評価</th>
            <th>住所</th>
            <th>コメント</th>
            <th>タグ</th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |post| %>
            <tr>
              <td><%= link_to post.user.name, admin_user_path(post.user_id) %></td>
              <td><%= link_to post.title, admin_post_path(post), data: {turbolinks: "false"} %></td>
              <td>
                <% if post.comments.any? %>
                  <%= number_with_precision(post.average_rating, precision: 1) %> / 5
                <% else %>
                  評価なし
                <% end %>
              </td>
              <td><%= post.address %></td>
              <td>
                <% if post.comments.any? %>
                  <%= post.comments.last.content.truncate(30) %>
                <% else %>
                  コメントなし
                <% end %>
              </td>
              <td>
                <% post.tags.each do |tag| %>
                  <%= link_to tag.name, admin_tag_path(tag), class: "badge badge-info" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>該当する投稿が見つかりませんでした</p>
    <% end %>
  <% end %>
  <div class="row d-flex justify-content-center mb-3">
    <%= paginate @records %>
  </div>
</div>